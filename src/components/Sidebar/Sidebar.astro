---
import "../Sidebar/style.css";
import SidebarHeader from "./Header.astro";
import SidebarItem from "./Item.astro";
import Perfil from "./Perfil.astro";
import Search from "../Search.astro";

// Obtener la URL actual para determinar la página activa
const currentPath = Astro.url.pathname;

// Función para determinar si un item está activo
function isActive(path: string): boolean {
  if (path === "/" && currentPath === "/") return true;
  if (path !== "/" && currentPath.includes(path)) return true;
  return false;
}
---

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link
    href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  />
  <script src="https://unpkg.com/feather-icons"></script>
</head>
<div
  id="sidebar"
  class="deep-ui-sidebar fixed top-0 left-0 h-screen z-30 w-72 flex flex-col overflow-y-auto bg-white dark:bg-slate-900 border-r border-[var(--border)]"
>
  <!-- Logo y Marca -->
  <SidebarHeader />

  <!-- Navegación -->
  <div class="px-4 py-8 flex-1 overflow-y-auto">
    <div class="mb-6">
      <span
        class="px-3 text-xs font-medium deep-ui-heading uppercase tracking-wider"
      >
        Menu
      </span>

      <div class="mt-3 space-y-1">
        <SidebarItem 
          href="/" 
          label="Inicio" 
          icon="home" 
          isActive={isActive("/")}
        />
        <SidebarItem 
          href="/frontend" 
          label="FrontEnd" 
          icon="bar-chart-2" 
          isActive={isActive("/frontend")}
        />
        <SidebarItem 
          href="/backend" 
          label="BackEnd" 
          icon="folder" 
          isActive={isActive("/backend")}
        />
        <SidebarItem 
          href="/testing" 
          label="Testing" 
          icon="message-square" 
          isActive={isActive("/testing")}
        />
        <SidebarItem 
          href="/mobile" 
          label="Mobile" 
          icon="calendar" 
          isActive={isActive("/mobile")}
        />
      </div>
    </div>
  </div>

  <!-- Perfil -->
  <Perfil/>
</div>

<script is:inline>
  document.addEventListener("DOMContentLoaded", function () {
    // Verificar que feather esté disponible antes de usarlo
    if (typeof feather !== 'undefined') {
      feather.replace();
    }

    // Mobil menü için gerekli elementler
    const mobileMenuButton = document.getElementById("mobile-menu-button");
    const closeSidebarButton = document.getElementById("close-sidebar");
    const sidebar = document.getElementById("sidebar");
    const overlay = document.getElementById("overlay");

    // Hamburger menü açma
    if (mobileMenuButton) {
      mobileMenuButton.addEventListener("click", function () {
        sidebar.classList.remove("-translate-x-full");
        if (overlay) overlay.classList.remove("hidden");
        document.body.classList.add("overflow-hidden");
      });
    }

    // Sidebar kapatma
    function closeSidebar() {
      sidebar.classList.add("-translate-x-full");
      if (overlay) overlay.classList.add("hidden");
      document.body.classList.remove("overflow-hidden");
    }

    if (closeSidebarButton) {
      closeSidebarButton.addEventListener("click", closeSidebar);
    }
    if (overlay) {
      overlay.addEventListener("click", closeSidebar);
    }

    // Ekran boyutu değiştiğinde kontrol
    window.addEventListener("resize", function () {
      if (window.innerWidth >= 768) {
        sidebar.classList.remove("-translate-x-full");
        if (overlay) overlay.classList.add("hidden");
        document.body.classList.remove("overflow-hidden");
      } else {
        sidebar.classList.add("-translate-x-full");
      }
    });
  });
</script>